<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=864">
    <title>Define &amp; Configure Inventory Policies</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans&display=swap">
    <link rel="stylesheet" href="document.css">
  </head>
  <body>
    <main>

      <h1 id="define-configure-inventory-policies">Define &amp; Configure Inventory Policies</h1>
      <p>Workarea includes multiple inventory policies, which encapsulate the logic for translating the administrable inventory values (e.g. <code>:available</code> and <code>:backordered</code>) into inventory SKU states (e.g. <code>#purchasable</code> and <code>#displayable</code>). ( See <a href="inventory.html#inventory-policies-sku-states">Inventory: Inventory Policies &amp; SKU States</a> for a full explanation. ) The included policies cover most use cases, but in order to satisfy the business requirements of a retailer, you may need to add one or more additional policies, or you may need to otherwise configure which policies are available (e.g. remove policies or re-order them within the Admin).</p>
      <p>To perform these tasks, you need to know how to define and configure inventory policies, which is the subject of this document. To define your own policy, add a class which implements the inventory policy interface: <code>#available_to_sell</code>, <code>#displayable?</code>, and <code>#purchase</code>. Then, to make the policy available, or to otherwise affect the available policies, manipulate the configurable inventory policy collection: <code>Workarea.config.inventory_policies</code>.</p>

      <nav>
        <ul>
          <li>
            <a href="#define-new-policies">Define New Policies</a>
            <ul>
              <li><a href="#examples">Examples</a></li>
            </ul>
          </li>
          <li><a href="#configure-available-policies">Configure Available Policies</a></li>
        </ul>
      </nav>

      <h2 id="define-new-policies">Define New Policies</h2>
      <p>To define a new policy, add a class definition at the following path:</p>
      <p><b><var>app_or_plugin_root</var>/app/models/workarea/inventory/policies/<var>policy_name</var>.rb</b></p>
      <p>Within this file, define a class within the module <code>Workarea::Inventory::Policies</code> that inherits from <code>Base</code> or a policy on which you will base the new policy.</p>
      <p>Finally, implement or re-implement any of the following methods that are unique to your policy (if inheriting from <code>Base</code>, you’ll need to implement all of them):</p>
      <ul>
        <li><code>#available_to_sell</code></li>
        <li><code>#displayable?</code></li>
        <li><code>#purchase(quantity)</code></li>
      </ul>
      <p>If you are unfamiliar with any of these methods, see <a href="inventory.html#inventory-policies-sku-states">Inventory: Inventory Policies &amp; SKU States</a> and <a href="inventory.html#purchasing-capturing-releasing-inventory">Inventory: Purchasing, Capturing, and Releasing Inventory</a>, and refer to the implementations of these methods within the existing inventory policies. The following command will print the pathnames of the inventory policies available to your application:</p>
      <pre><samp>$ <kbd>find $(pwd) $(bundle show --paths | grep workarea) \</kbd>
&gt; <kbd>-path &#39;*/app/*/inventory/policies/*.rb&#39; | sort -u</kbd>
$</samp></pre>

      <h3 id="examples">Examples</h3>
      <p>As an example, the “offline” policy ensures a shopper can view the item on the website but cannot purchase it (which must be done over the phone or by some other means explained on the screen):</p>
      <pre><code># &lt;app or plugin root&gt;/app/models/workarea/inventory/policies/offline.rb

module Workarea
  module Inventory
    module Policies
      class Offline &lt; Base
        def displayable?
          true
        end

        def available_to_sell
          0
        end

        def purchase(quantity)
          # noop
        end
      end
    end
  end
end</code></pre>
      <p>The “in store only” policy relies on other extensions that exist in the application or plugin:</p>
      <pre><code># &lt;app or plugin root&gt;/app/models/workarea/inventory/policies/in_store_only.rb

module Workarea
  module Inventory
    module Policies
      class InStoreOnly &lt; Standard
        def available_to_sell
          sku.available_in_store
        end

        def purchase(quantity)
          # noop
        end
      end
    end
  end
end</code></pre>

      <h2 id="configure-available-policies">Configure Available Policies</h2>
      <p>Add your new policy to the configurable collection of available inventory policies:</p>
      <pre><code># &lt;app or plugin root&gt;/config/initializers/inventory_policies.rb

Workarea.config.inventory_policies &lt;&lt; &#39;Workarea::Inventory::Policies::Offline&#39;</code></pre>
      <p>You can also remove or sort the policies using the methods of <a>SwappableList</a>. When saving an inventory policy, its policy is validated to ensure it is a member of this collection. And this is the list of policies that is presented for selection within the inventory SKU administration screens. The first policy in this collection is the default policy for new inventory SKUs.</p>
    </main>
  </body>
</html>
