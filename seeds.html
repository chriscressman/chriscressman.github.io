<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.86, maximum-scale=3.0, minimum-scale=0.86">
    <title>Seeds</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Fira+Sans&display=swap">
    <link rel="stylesheet" href="document.css">
  </head>

  <body>
    <div class="medium-wrapper">

      <h1 id="seeds">Seeds</h1>
      <p><dfn>Seeds</dfn> are default data appropriate for developing, testing, or otherwise using a Workarea application, particularly in a development environment. <dfn>Seeding</dfn> is the process of writing the seeds within a particular environment.</p>
      <p>Be careful! <strong>Seeding is a destructive process</strong> that purges all existing MongoDB and Elasticsearch data before writing. Be certain you are willing to lose all data before running seeds in an environment.</p>
      <p>Seeding is performed exclusively through a command line interface. To seed an environment, bundle the application and run the db:seed task:</p>
      <pre><samp>$ <kbd>cd application_directory</kbd>
$ <kbd>bundle</kbd>
$ <kbd>bin/rails db:seed</kbd></samp></pre>
      <p>See below for a detailed example.</p>
      <p>The base platform includes the seeds necessary to use a generic Workarea application. Plugins and applications can extend seeds as necessary to support platform customizations. (I’ll cover seeds implementation and extension in detail in a future guide.)</p>

      <nav>
        <ul>
          <li>
            <a href="#seeding-a-new-development-environment">Seeding a New Development Environment</a>
            <ul>
              <li><a href="#before-seeding">Before Seeding</a></li>
              <li><a href="#seeding">Seeding</a></li>
              <li><a href="#after-seeding">After Seeding</a></li>
              <li><a href="#admin-access">Admin Access</a></li>
            </ul>
          </li>
          <li><a href="#re-seeding">Re-Seeding</a></li>
          <li><a href="#extending-seeds">Extending Seeds</a></li>
          <li><a href="#summary">Summary</a></li>
          <li><a href="#notes">Notes</a></li>
        </ul>
      </nav>

      <h2 id="seeding-a-new-development-environment">Seeding a New Development Environment</h2>
      <p>To demonstrate seeds, consider the fictional Workarea application <cite>Boardgamz</cite>, newly created within a fresh <a href="create-a-new-app.html">Workarea app</a>.</p>

      <h3 id="before-seeding">Before Seeding</h3>
      <p>This environment has no MongoDB databases, collections, or documents, except for the default <em>test</em> and <em>local</em> databases:</p>
      <pre><code>$ mongo --eval &#39;db.getMongo().getDBNames()&#39;
MongoDB shell version: 3.2.5
connecting to: test
[&quot;local&quot;]
$</code></pre>
      <p>And there are no Elasticsearch indexes or documents:</p>
      <pre><code>$ curl localhost:9200/_cat/indices?v
health status index uuid pri rep docs.count docs.deleted store.size pri.store.size
$</code></pre>
      <p>You can start the application within the development environment, but you can’t do much with it:</p>
      <figure>
        <img src="before-seeding.png" alt="Before seeding">
        <figcaption>Before seeding</figcaption>
      </figure>
      <p>There is no navigation and nothing to search for. There are no products, categories, or content to browse. The Admin is inaccessible because there are no users who can authenticate as administrators.</p>
      <p>To use this application, you need data. If you’re new to Workarea, you may be surprised how much data is required for a typical flow, such as the process of adding some products to the cart and checking out. This path requires at least a few model instances from each of the following business domains:</p>
      <ul>
        <li>Catalog</li>
        <li>Inventory</li>
        <li>Navigation</li>
        <li>Pricing</li>
        <li>Shipping</li>
        <li>Tax</li>
      </ul>
      <p>Seeding provides an effective way to write this necessary data with little effort.</p>

      <h3 id="seeding">Seeding</h3>
      <p>The following example demonstrates seeding the environment. The output will display progressively as the process runs.</p>
      <pre><code>$ bin/rails db:seed
== Setting up...
Deleting Elasticsearch indexes...
Cleaning MongoDB collections...
Flushing Redis database...
Ensuring MongoDB indexes...
Ensuring Elasticsearch indexes...

== Loading MongoDB data
Adding search settings...
Adding content emails...
Adding tax rates...
Adding shipping services...
Adding assets...
Adding categories...
Adding products...
Adding auxiliary pages...
Adding browsing pages...
Adding discounts...
Adding dynamic content...
Adding browsing navigation...
Adding customer service navigation...
Adding system content...
Adding admin users...
Adding customers...
Adding orders...
Adding inquiries...
Adding help articles...
Adding analytics...

== Loading Elasticsearch data
Indexing storefront...
Indexing admin...
Indexing help...

Success!
$</code></pre>

      <h3 id="after-seeding">After Seeding</h3>
      <p>After seeding, MongoDB contains a development database for the application</p>
      <pre><code>$ mongo --eval &#39;db.getMongo().getDBNames()&#39;
MongoDB shell version: 3.2.5
connecting to: test
[&quot;boardgamz_development&quot;, &quot;local&quot;]
$</code></pre>
      <p>that holds many collections</p>
      <pre><code>$ mongo boardgamz_development --eval &quot;db.getCollectionNames().length&quot;
MongoDB shell version: 3.2.5
connecting to: boardgamz_development
61
$</code></pre>
      <p>some of which are listed below:</p>
      <pre><code>$ mongo boardgamz_development --eval &quot;db.getCollectionNames().slice(0,20)&quot;
MongoDB shell version: 3.2.5
connecting to: boardgamz_development
[
  &quot;mongoid_audit_log_entries&quot;,
  &quot;workarea_analytics_categories&quot;,
  &quot;workarea_analytics_category_revenues&quot;,
  &quot;workarea_analytics_discount_revenues&quot;,
  &quot;workarea_analytics_discounts&quot;,
  &quot;workarea_analytics_discounts_summaries&quot;,
  &quot;workarea_analytics_filters&quot;,
  &quot;workarea_analytics_last_four_weeks_searches&quot;,
  &quot;workarea_analytics_navigations&quot;,
  &quot;workarea_analytics_new_customers&quot;,
  &quot;workarea_analytics_orders_summaries&quot;,
  &quot;workarea_analytics_product_revenues&quot;,
  &quot;workarea_analytics_products&quot;,
  &quot;workarea_analytics_search_abandonment_rates&quot;,
  &quot;workarea_analytics_searches&quot;,
  &quot;workarea_analytics_signups&quot;,
  &quot;workarea_analytics_users&quot;,
  &quot;workarea_bulk_actions&quot;,
  &quot;workarea_catalog_categories&quot;,
  &quot;workarea_catalog_product_placeholder_images&quot;
]
$</code></pre>
      <p>Likewise, Elasticsearch contains multiple indexes for the application</p>
      <pre><code>$ curl localhost:9200/_cat/indices?v
health status index uuid pri rep docs.count docs.deleted store.size pri.store.size
yellow open boardgamz_development_en_storefront D38474KwRS6oYndzWtjnrQ 5 1 140 4 964.9kb 964.9kb
yellow open boardgamz_development_en_help j5M7K9QrT1a109VIujukcg 5 1 52 0 1.2mb 1.2mb
yellow open boardgamz_development_en_admin 3fTuI3raSjePJU1IJvmBTw 5 1 762 0 2mb 2mb
$</code></pre>
      <p>which hold many documents:</p>
      <pre><code>$ curl localhost:9200/_cat/count?v
epoch timestamp count
1511905005 21:36:45 954
$</code></pre>
      <p>The upshot of this is a usable Storefront, complete with products, categories, content, navigation, and other data:</p>
      <figure>
        <img src="after-seeding.png" alt="After seeding">
        <figcaption>After seeding</figcaption>
      </figure>

      <h3 id="admin-access">Admin Access</h3>
      <p>Seeding also provides access to the Admin, which is displaying order and analytics data that was also seeded:</p>
      <figure>
        <img src="seeded-admin.png" alt="Seeded Admin">
        <figcaption>Seeded Admin</figcaption>
      </figure>
      <p>In a development environment, the following credentials provide super admin privileges (assuming you haven’t customized your admin user seeds):</p>
      <table>
        <thead>
          <tr>
            <th>Email</th>
            <th>user@workarea.com</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Password</td>
            <td>W3bl1nc!</td>
          </tr>
        </tbody>
      </table>

      <h2 id="re-seeding">Re-Seeding</h2>
      <p>The seeds included with Core use some random data, so seeding is not idempotent.&nbsp;<sup><a href="#note-1" id="note-1-context">[1]</a></sup> However, re-seeding should produce data that is uniform—having the same general “shape”—each time.</p>
      <p>To demonstrate, use Mongoid to query the number of products and the first product in the Boardgamz development database:</p>
<pre><code>$ bin/rails r &#39;puts Workarea::Catalog::Product.count&#39;
90
$ bin/rails r &#39;puts Workarea::Catalog::Product.first.name&#39;
Heavy Duty Aluminum Knife
$</code></pre>
      <p>Now, re-seed. (Also capture the seeding output to a file and add it to the git index—this is for a future example.)</p>
      <pre><code>$ bin/rails db:seed &gt; seeding_output
$ git add seeding_output
$</code></pre>
      <p>After seeding completes, query the products again. You end up with the same <em>number</em> of products, but the products themselves are different.</p>
      <pre><code>$ bin/rails r &#39;puts Workarea::Catalog::Product.count&#39;
90
$ bin/rails r &#39;puts Workarea::Catalog::Product.first.name&#39;
Aerodynamic Linen Keyboard
$</code></pre>
      <p>As another example, the image below shows the Storefront after re-seeding. Comparing it to the Storefront image above, you can see the “Header Promo Body” is identical, while the navigation is similar but different:</p>
      <figure>
        <img src="after-re-seeding.png" alt="After re-seeding">
        <figcaption>After re-seeding</figcaption>
      </figure>
      <p>The uniformity of seeds makes them valuable for the following additional use cases:</p>
      <ul>
        <li>Generally synchronizing your development environment data with other developers on your team</li>
        <li>Loading data to support new features or extensions added by you or other developers on your team</li>
        <li>Updating default data after installing or removing plugins from your application</li>
        <li>Restoring your application data to a known-good state</li>
      </ul>
      <p>It is therefore sensible to re-seed your development environment in the following situations:</p>
      <ul>
        <li>After you’ve added a feature or extension which includes seeds (to ensure the seeds are adequate)</li>
        <li>After changing which plugins are installed</li>
        <li>After merging changes from another developer where either of the above is applicable</li>
        <li>When experiencing issues in development that may be data-related</li>
      </ul>

      <h2 id="extending-seeds">Extending Seeds</h2>
      <p>As an application developer, you can define your own seeds. You can also <a href="decoration.html">decorate</a> and <a href="configuration.html">configure</a> existing seeds. However, these techniques depend on an understanding of how seeds are implemented, which I haven’t covered yet.</p>
      <p>Therefore, let’s instead take a look at how your installed plugins affect your seeds. Plugins typically add <em>new</em> seeds, which support the other extensions applied within the plugin. For example, the blog plugin seeds blogs, entries, and comments; while the clothing and package products plugins seed additional products.</p>
      <p>To see this, add some plugins to the application, as shown in the following git patch:</p>
      <pre><code>diff --git a/Gemfile b/Gemfile
index 0efec88..b3f9095 100644
--- a/Gemfile
+++ b/Gemfile
@@ -45,4 +45,11 @@ end

 source &#39;https://gems.workarea.com&#39; do
   gem &#39;workarea&#39;, &#39;3.1.5&#39;
+ gem &#39;workarea-blog&#39;, &#39;3.1.1&#39;
+ gem &#39;workarea-clothing&#39;, &#39;2.1.3&#39;
+ gem &#39;workarea-gift_cards&#39;, &#39;3.2.1&#39;
+ gem &#39;workarea-package_products&#39;, &#39;3.1.2&#39;
+ gem &#39;workarea-reviews&#39;, &#39;2.1.0&#39;
+ gem &#39;workarea-store_locator&#39;, &#39;4.0.0&#39;
+ gem &#39;workarea-wish_lists&#39;, &#39;2.0.3&#39;
 end</code></pre>
      <p>Bundle the app; then re-seed and capture the seeding output to the same file as above.</p>
      <pre><code>$ bundle
$ bin/rails db:seed &gt; seeding_output</code></pre>
      <p>After seeding completes, diff the output file to see how the seeding output has changed after installing plugins:</p>
      <pre><code>$ git diff seeding_output</code></pre>
      <p>You should see several additions:</p>
      <pre><code>diff --git a/seeding_output b/seeding_output
index 1fc7ea7..7c4d768 100644
--- a/seeding_output
+++ b/seeding_output
@@ -16,6 +16,8 @@ Adding shipping services...
 Adding assets...
 Adding categories...
 Adding products...
+Adding package products...
+Adding clothing products...
 Adding auxiliary pages...
 Adding browsing pages...
 Adding discounts...
@@ -25,10 +27,17 @@ Adding customer service navigation...
 Adding system content...
 Adding admin users...
 Adding customers...
+Adding blogs...
+Adding blog entries...
+Adding blog comments...
 Adding orders...
 Adding inquiries...
 Adding help articles...
 Adding analytics...
+Adding gift cards...
+Adding reviews...
+Adding store locations...
+Adding wish lists...

 == Loading Elasticsearch data
 Indexing storefront...</code></pre>
      <p>Additionally, count the products again:</p>
      <pre><code>$ bin/rails r &#39;puts Workarea::Catalog::Product.count&#39;
103</code></pre>
      <p>If you compare the result to the same query above, you can see there are additional products in the database. These additional products include data to support the functionality of the clothing, package products, and gift cards plugins. To boot, the reviews plugin adds rating and review data to <em>all</em> products. You can see some of these new products and additional data in the following view of the Storefront:</p>
      <figure>
        <img src="seeds-from-plugins.png" alt="Seeds from plugins">
        <figcaption>Seeds from plugins</figcaption>
      </figure>

      <h2 id="summary">Summary</h2>
      <ul>
        <li>Seeds are default data, which make your application usable for development and generally consistent with the other developers on your team</li>
        <li>Seeding, performed from the command line, is the (destructive) process of writing seeds to an environment</li>
        <li>Re-seeding should produce uniform, but not identical, data each time</li>
        <li>You should re-seed your development environment as needed to resolve data issues and after you or another developer extends seeds or changes installed plugins</li>
        <li>Plugins often include their own seeds to support the plugins’ other extensions to the platform</li>
      </ul>

      <h2 id="notes">Notes</h2>
      <p><a href="#note-1-context" id="note-1">[1]</a> Of course, since seeds are extensible, you can write your own seeds to be idempotent if you so desire.</p>

    </div>
  </body>
</html>
